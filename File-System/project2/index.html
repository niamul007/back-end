<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple data handeling</title>
  </head>
  <body>
    <form id="form">
      <input type="text" name="name" id="nameField" />
      <button type="submit" id="btn">Add</button>
    </form>
    <div id="nameContainer"></div>
    <script>
      const form = document.getElementById("form");
      const container = document.getElementById("nameContainer");

      // 1. Grab HTML elements
      // 2. Create a function to GET data and show it in the table
      // 3. Create a listener for the form to POST new data
      // 4. Create a function to DELETE data

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("nameField").value;
        console.log(name);
        const btn = document.getElementById("btn");

        btn.innerText = "Posting..";
        btn.disableed = true;

        try {
          const res = await fetch("/add-task", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name }),
          });

          if (res.ok) {
            form.reset();
            loadName();
          }
        } catch (error) {
          console.error("Post failed:", error);
          alert("Could not save task.");
        } finally {
          btn.innerText = "Add Task";
          btn.disabled = false;
        }
      });

      async function loadName() {
        const res = await fetch("/name");
        const data = await res.json();

        container.innerHTML = "";

        // Inside your forEach
        // Inside your loadName forEach
        data.forEach((n) => {
          const div = document.createElement("div");
          // FIX 1: Correct onclick syntax and pass ID + this
          div.innerHTML = `
            <p>${n.name}</p>
            <button onclick="delData(${n.id}, this)" style="background-color:red; color:white;">Delete</button>
        `;
          container.appendChild(div);
        });

        // ... inside your script ...
      }
      loadName(); // FIX 2: Call this at the end so data shows up on refresh!

      async function delData(id, buttonElement) {
        if (buttonElement.innerText === "Delete") {
          buttonElement.innerText = "Are you sure?";
          buttonElement.style.backgroundColor = "orange";
          setTimeout(() => {
            buttonElement.innerText = "Delete";
            buttonElement.style.backgroundColor = "red";
          }, 3000);
          return;
        }

        buttonElement.innerText = "Deleting..";
        buttonElement.disabled = true;
        try {
          const res = await fetch(`/delete-name/${id}`, { method: "DELETE" });
          if (res.ok) {
            loadName();
          }
        } catch (error) {
          buttonElement.innerText = "Error!";
          buttonElement.disabled = false;
        }
      }
    </script>
  </body>
</html>
