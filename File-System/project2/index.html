<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Manager Dashboard</title>
    <style>
      /* --- Root & Layout --- */
      body {
        font-family: "Segoe UI", Roboto, sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        display: flex;
        justify-content: center;
        padding-top: 50px;
      }

      .app-container {
        width: 100%;
        max-width: 500px;
        background: #ffffff;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      }

      h2 { text-align: center; color: #2d3436; margin-bottom: 25px; }

      /* --- Form Styling --- */
      #form { display: flex; flex-direction: column; gap: 12px; margin-bottom: 30px; }
      input { padding: 14px; border: 2px solid #edf2f7; border-radius: 10px; outline: none; transition: 0.2s; }
      input:focus { border-color: #007bff; }
      #btn { padding: 14px; background-color: #007bff; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; }

      /* --- Card Styling --- */
      .item-card {
        background: #ffffff;
        border: 1px solid #e2e8f0;
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 15px;
        border-left: 6px solid #007bff;
      }
      .item-card h4 { margin: 0 0 5px 0; color: #2d3436; }
      .item-card p { margin: 0 0 15px 0; color: #636e72; font-size: 14px; }

      /* --- Button Grouping --- */
      .button-group { display: flex; justify-content: flex-end; gap: 8px; }

      .del-btn { background-color: #ff7675; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; }
      .edit-btn { background-color: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; }
      
      /* Save State - Green */
      .save-mode { background-color: #2ecc71 !important; }

      /* Styled input for Edit Mode */
      .edit-input {
        width: 100%;
        padding: 8px;
        border: 2px solid #f1c40f;
        border-radius: 5px;
        margin-bottom: 10px;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <h2>My Tasks</h2>
      <form id="form">
        <input type="text" id="nameField" placeholder="Task Name" required />
        <input type="text" id="description" placeholder="Details" required />
        <button type="submit" id="btn">Add Task</button>
      </form>
      <div id="nameContainer"></div>
    </div>

    <script>
      const form = document.getElementById("form");
      const container = document.getElementById("nameContainer");

      // --- CREATE ---
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("nameField").value;
        const description = document.getElementById("description").value;
        const btn = document.getElementById("btn");
        btn.disabled = true;

        try {
          const res = await fetch("/add-task", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, description }),
          });
          if (res.ok) { form.reset(); loadName(); }
        } finally { btn.disabled = false; }
      });

      // --- READ ---
      async function loadName() {
        const res = await fetch("/name");
        const data = await res.json();
        container.innerHTML = data.length === 0 ? `<p class="empty-msg">No tasks found.</p>` : "";
        
        data.forEach((n) => {
          const div = document.createElement("div");
          div.className = "item-card";
          div.innerHTML = `
            <h4>${n.name}</h4>
            <p id="description-${n.id}">${n.description}</p>
            <div class="button-group">
              <button class="edit-btn" onclick="editData(${n.id}, this)">Edit</button>
              <button class="del-btn" onclick="delData(${n.id}, this)">Delete</button>
            </div>
          `;
          container.appendChild(div);
        });
      }

      // --- UPDATE Logic ---
      function editData(id, editBtn) {
        const description = document.getElementById(`description-${id}`);
        const originalText = description.innerText;

        // Apply styled input class
        description.innerHTML = `<input type="text" id="input-${id}" class="edit-input" value="${originalText}">`;
        
        editBtn.innerText = "Save";
        editBtn.classList.add("save-mode");
        editBtn.onclick = () => saveData(id, editBtn);
      }

      async function saveData(id, saveBtn) {
        const newDesc = document.getElementById(`input-${id}`).value;
        try {
          const res = await fetch(`/update-data/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ description: newDesc }),
          });
          if (res.ok) loadName();
        } catch (error) { console.error(error); }
      }

      // --- DELETE ---
      async function delData(id, btn) {
        if (btn.innerText === "Delete") {
          btn.innerText = "Sure?";
          btn.style.backgroundColor = "#fdcb6e";
          setTimeout(() => { if(btn.innerText === "Sure?") { btn.innerText = "Delete"; btn.style.backgroundColor = "#ff7675"; }}, 3000);
          return;
        }
        await fetch(`/delete-name/${id}`, { method: "DELETE" });
        loadName();
      }

      loadName();
    </script>
  </body>
</html>